#!/usr/bin/env python3import osimport pandas as pdimport matplotlib.pyplot as pltimport argparseimport globdef parse_arguments():    parser = argparse.ArgumentParser(description='Analyze Knowledge Distillation Grid Search Results')    parser.add_argument('--experiment_dir', type=str, required=True,                         help='Directory containing experiment results')    parser.add_argument('--metric', type=str, default='metrics/mAP50-95(B)',                        help='Metric to analyze (column name in results.csv)')    parser.add_argument('--output_prefix', type=str, default='kd_analysis',                        help='Prefix for output files')    return parser.parse_args()def main():    args = parse_arguments()        # Check if directory exists    if not os.path.isdir(args.experiment_dir):        print(f"Error: Directory {args.experiment_dir} not found")        return 1        # Get all CSV files in directory    csv_files = glob.glob(os.path.join(args.experiment_dir, "kd_a*_results.csv"))    if not csv_files:        print(f"Error: No result CSV files found in {args.experiment_dir}")        return 1        print(f"Found {len(csv_files)} result files to analyze")        # Extract parameters from filenames and load data    results = []    for csv_file in csv_files:        # Extract alpha and temperature from filename        filename = os.path.basename(csv_file)        params = filename.split('_')        if len(params) >= 3:            alpha = float(params[1][1:])  # remove 'a' prefix            temperature = float(params[2][1:])  # remove 't' prefix                        # Load the CSV data (last line contains final metrics)            try:                df = pd.read_csv(csv_file)                if len(df) > 0:                    last_row = df.iloc[-1]                                        # Extract the requested metric                    if args.metric in last_row:                        metric_value = last_row[args.metric]                        results.append({                            'alpha': alpha,                            'temperature': temperature,                            'metric': metric_value                        })                    else:                        print(f"Warning: Metric '{args.metric}' not found in {csv_file}")                        available_metrics = list(last_row.index)                        print(f"Available metrics: {available_metrics}")            except Exception as e:                print(f"Error processing {csv_file}: {e}")        if not results:        print("No valid results found to analyze")        return 1        # Convert to DataFrame for analysis    results_df = pd.DataFrame(results)        # Create output directory    output_dir = os.path.join(args.experiment_dir, 'analysis')    os.makedirs(output_dir, exist_ok=True)        # Save to CSV    output_csv = os.path.join(output_dir, f"{args.output_prefix}_summary.csv")    results_df.to_csv(output_csv, index=False)    print(f"Saved summary CSV to {output_csv}")        # Get unique alpha and temperature values    alpha_values = sorted(results_df['alpha'].unique())    temp_values = sorted(results_df['temperature'].unique())        # Create a pivot table for visualization    pivot_df = results_df.pivot(index='temperature', columns='alpha', values='metric')        # Generate heatmap    plt.figure(figsize=(10, 8))    plt.imshow(pivot_df, cmap='viridis', interpolation='nearest')    plt.colorbar(label=args.metric)    plt.title(f'Knowledge Distillation Performance ({args.metric})')    plt.xlabel('Alpha')    plt.ylabel('Temperature')        # Set x and y ticks    plt.xticks(range(len(alpha_values)), alpha_values)    plt.yticks(range(len(temp_values)), temp_values)        # Add text annotations    for i in range(len(temp_values)):        for j in range(len(alpha_values)):            if (temp_values[i] in pivot_df.index) and (alpha_values[j] in pivot_df.columns):                value = pivot_df.iloc[i, j]                plt.text(j, i, f'{value:.4f}', ha='center', va='center',                         color='white' if value > pivot_df.mean().mean() else 'black')        # Save plot    output_plot = os.path.join(output_dir, f"{args.output_prefix}_heatmap.png")    plt.savefig(output_plot)    print(f"Saved heatmap visualization to {output_plot}")        # Find best parameter combination    best_row = results_df.loc[results_df['metric'].idxmax()]    print(f"\nBest Parameter Combination:")    print(f"Alpha: {best_row['alpha']}")    print(f"Temperature: {best_row['temperature']}")    print(f"Metric ({args.metric}): {best_row['metric']}")        # Save best parameters to file    with open(os.path.join(output_dir, f"{args.output_prefix}_best_params.txt"), 'w') as f:        f.write(f"Best Parameter Combination:\n")        f.write(f"Alpha: {best_row['alpha']}\n")        f.write(f"Temperature: {best_row['temperature']}\n")        f.write(f"Metric ({args.metric}): {best_row['metric']}\n")        # Create line plots    # Plot metric vs alpha for each temperature    plt.figure(figsize=(12, 6))    for temp in temp_values:        temp_data = results_df[results_df['temperature'] == temp]        if not temp_data.empty:            plt.plot(temp_data['alpha'], temp_data['metric'], 'o-', label=f'Temp={temp}')        plt.title(f'Effect of Alpha on {args.metric} at Different Temperatures')    plt.xlabel('Alpha')    plt.ylabel(args.metric)    plt.legend()    plt.grid(True)    output_alpha_plot = os.path.join(output_dir, f"{args.output_prefix}_alpha_effect.png")    plt.savefig(output_alpha_plot)        # Plot metric vs temperature for each alpha    plt.figure(figsize=(12, 6))    for alpha in alpha_values:        alpha_data = results_df[results_df['alpha'] == alpha]        if not alpha_data.empty:            plt.plot(alpha_data['temperature'], alpha_data['metric'], 'o-', label=f'Alpha={alpha}')        plt.title(f'Effect of Temperature on {args.metric} at Different Alpha Values')    plt.xlabel('Temperature')    plt.ylabel(args.metric)    plt.legend()    plt.grid(True)    output_temp_plot = os.path.join(output_dir, f"{args.output_prefix}_temp_effect.png")    plt.savefig(output_temp_plot)        print(f"Analysis complete. All outputs saved to {output_dir}")    return 0if __name__ == '__main__':    exit_code = main()    exit(exit_code)
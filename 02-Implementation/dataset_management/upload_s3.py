import osimport zipfileimport boto3import argparsefrom dotenv import load_dotenvfrom version_manager import generate_new_versiondef zip_directory(directory_path: str, output_path: str):    """Compresses a directory into a zip file."""    with zipfile.ZipFile(output_path, 'w', zipfile.ZIP_DEFLATED) as zipf:        for root, dirs, files in os.walk(directory_path):            for file in files:                file_path = os.path.join(root, file)                arcname = os.path.relpath(file_path, directory_path)                zipf.write(file_path, arcname)def upload_to_s3(file_path: str, bucket_name: str, s3_key: str):    """Uploads a file to AWS S3 using credentials from environment variables."""    s3 = boto3.client(        's3',        aws_access_key_id=os.getenv("AWS_ACCESS_KEY_ID"),        aws_secret_access_key=os.getenv("AWS_SECRET_ACCESS_KEY"),        region_name=os.getenv("AWS_DEFAULT_REGION")    )    with open(file_path, 'rb') as file:        s3.upload_fileobj(file, bucket_name, s3_key)def main():    load_dotenv()    parser = argparse.ArgumentParser(description="Zip a folder and upload to AWS S3.")    parser.add_argument("source_folder", help="Path to the folder to zip and upload")    parser.add_argument("s3_subfolder", nargs="?", default=os.getenv("S3_FOLDER_PATH", ""),                        help="Optional subfolder in S3 bucket")    args = parser.parse_args()    bucket_name = os.getenv("S3_BUCKET_NAME")    if not args.source_folder or not bucket_name:        print("[ERROR] SOURCE_FOLDER and S3_BUCKET_NAME must be defined")        return    dir_name = os.path.basename(args.source_folder.rstrip("/"))    version = generate_new_version(dir_name, notes="Automated upload")    zip_name = f"{dir_name}_{version}.zip"    zip_path = os.path.join("/tmp", zip_name)    print(f"[INFO] Zipping folder '{args.source_folder}' into '{zip_path}'...")    zip_directory(args.source_folder, zip_path)    s3_key = os.path.join(args.s3_subfolder, zip_name) if args.s3_subfolder else zip_name    print(f"[INFO] Uploading '{zip_path}' to 's3://{bucket_name}/{s3_key}'...")    upload_to_s3(zip_path, bucket_name, s3_key)    print("[✓] Upload completed!")    if os.getenv("DELETE_ZIP_AFTER_UPLOAD", "true").lower() == "true":        os.remove(zip_path)        print("[✓] Local zip deleted.")if __name__ == "__main__":    main()